---
title: "CLI Reference"
description: "Command-line interface for running and managing Griffin tests"
---

## Overview

The Griffin CLI is a command-line tool that allows you to discover, run, and manage API tests. It can be used locally during development or to interact with remote runner services.

## Installation

### Global Installation

```bash
npm install -g griffin-cli
```

### Using npx (No Installation)

```bash
npx griffin-cli run-local
```

### Building from Source

```bash
cd griffin-cli
npm install
npm run build
node dist/cli.js run-local
```

## Commands

### Project Initialization

#### `init`

Initializes Griffin in your project by creating necessary configuration files.

```bash
griffin init
```

**What it does**:
- Creates `.griffin/` directory for state management
- Sets up initial configuration structure
- Prepares project for environment management

#### `generate-key`

Generates a secure API key for hub authentication.

```bash
griffin generate-key
```

### Environment Management

#### `env list`

Lists all configured environments.

```bash
griffin env list
```

#### `env add <name>`

Adds a new environment.

```bash
griffin env add production
griffin env add staging
griffin env add dev
```

#### `env remove <name>`

Removes an environment.

```bash
griffin env remove dev
```

### Local Execution

#### `local run <environment>`

Runs all discovered tests locally against the specified environment.

```bash
griffin local run dev
griffin local run staging
```

**What it does**:
1. Scans for test files matching `**/__griffin__/*.{ts,js}`
2. Compiles TypeScript tests to JSON monitors
3. Executes monitors using griffin-executor
4. Displays results in terminal with detailed output

**Example Output**:
```
Discovering monitors...
Found 3 monitors in __griffin__ directories

Running: health-check (dev)
  ✓ GET /health - 200 OK (45ms)
  ✓ Assertion: status equals 200 - PASS

Running: user-flow (dev)
  ✓ POST /users - 201 Created (120ms)
  ✓ GET /users/123 - 200 OK (30ms)
  ✓ DELETE /users/123 - 204 No Content (25ms)

Summary: 2 passed, 0 failed
```

#### `validate`

Validates all discovered test files without executing them.

```bash
griffin validate
```

### Hub Authentication

#### `hub login`

Authenticates with hub using OIDC device authorization flow.

```bash
griffin hub login
```

**What it does**:
1. Initiates OIDC device flow
2. Displays authorization URL and code
3. Waits for user to complete authentication
4. Stores credentials in `~/.griffin/credentials.json`

#### `hub connect`

Authenticates with hub using API key.

```bash
griffin hub connect --url https://hub.example.com --token <api-key>
```

**Options**:
- `--url`: Hub base URL
- `--token`: API key for authentication

#### `hub status`

Shows current hub connection status.

```bash
griffin hub status
```

### Hub Management

#### `hub apply <environment>`

Deploys monitors to the hub for the specified environment.

```bash
griffin hub apply production
griffin hub apply staging
```

**What it does**:
1. Discovers and compiles all monitors
2. Uploads monitors to hub via REST API
3. Hub scheduler begins executing monitors based on frequency

#### `hub monitor <environment>`

Lists all monitors deployed to hub for an environment.

```bash
griffin hub monitor production
```

**Example Output**:
```
Monitors (production):
  - health-check (every 1 minute, location: us-east-1)
  - api-integration (every 15 minutes, location: eu-west-1)
  - smoke-test (every 1 hour, location: us-west-2)
```

#### `hub runs [--limit N]`

Views execution run history from the hub.

```bash
griffin hub runs
griffin hub runs --limit 20
```

**Options**:
- `--limit`: Number of runs to display (default: 10)

**Example Output**:
```
Recent Runs:
  health-check - SUCCESS - 2 minutes ago (us-east-1)
  api-integration - SUCCESS - 5 minutes ago (eu-west-1)
  health-check - SUCCESS - 3 minutes ago (us-east-1)
  smoke-test - FAILURE - 1 hour ago (us-west-2)
```

#### `hub run <environment> --monitor <name>`

Triggers manual execution of a specific monitor.

```bash
griffin hub run production --monitor health-check
```

## Test Discovery

The CLI automatically discovers test files by:

1. **Scanning for directories**: Looks for `__griffin__` subdirectories
2. **Finding test files**: Identifies all `.ts` files within those directories
3. **Validating tests**: Ensures each file properly exports a test plan

### Directory Structure

```
my-project/
├── src/
│   └── ...
├── __griffin__/
│   ├── health-check.ts
│   └── api-tests.ts
└── packages/
    └── api/
        └── __griffin__/
            └── integration-tests.ts
```

All test files in any `__griffin__` directory will be discovered and executed.

### Test File Requirements

Each test file must:
- Be a TypeScript (`.ts`) or JavaScript (`.js`) file
- Import from `griffin-ts`
- Use `createTestBuilder` or `createGraphBuilder`
- Export the monitor as default export

```typescript
// Valid test file (Sequential Builder)
import { createTestBuilder, GET, JSON, Assert, Frequency } from "griffin-ts";

const monitor = createTestBuilder({
  name: "my-test",
  endpoint_host: "http://localhost:3000"
})
  .endpoint("health", {
    method: GET,
    response_format: JSON,
    path: "/health"
  })
  .assert((state) => [
    Assert(state["health"].status).equals(200)
  ])
  .build({ frequency: Frequency.every(1).minute() });

export default monitor;
```

```typescript
// Valid test file (Graph Builder)
import { createGraphBuilder, START, END, GET, JSON, Frequency } from "griffin-ts";

const monitor = createGraphBuilder({
  name: "complex-test",
  endpoint_host: "http://localhost:3000"
})
  .addEndpoint("health", { method: GET, response_format: JSON, path: "/health" })
  .addEdge(START, "health")
  .addEdge("health", END)
  .build({ frequency: Frequency.every(5).minutes() });

export default monitor;
```

## Configuration

### State Management

Griffin stores state in `.griffin/state.json` in your project:

```json
{
  "hubUrl": "https://hub.example.com",
  "environments": ["dev", "staging", "production"],
  "currentEnvironment": "dev"
}
```

This file is automatically managed by CLI commands and should be committed to version control.

### Hub Configuration

Hub connection details are stored in `~/.griffin/credentials.json`:

```json
{
  "hubUrl": "https://hub.example.com",
  "authMode": "oidc",
  "accessToken": "<token>",
  "refreshToken": "<token>",
  "expiresAt": 1234567890
}
```

**Security**: This file contains sensitive credentials and should never be committed to version control.

### Environment-Specific Configuration

Each environment can have different endpoint hosts configured in your monitors:

```typescript
const monitor = createTestBuilder({
  name: "health-check",
  endpoint_host: process.env.API_HOST || "http://localhost:3000"
})
  .endpoint("health", { method: GET, path: "/health" })
  .build({ frequency: Frequency.every(1).minute() });
```

Use environment variables to configure different hosts per environment:
```bash
# dev
export API_HOST=http://localhost:3000

# staging
export API_HOST=https://staging-api.example.com

# production
export API_HOST=https://api.example.com
```

## Exit Codes

The CLI uses standard exit codes:

- `0`: All tests passed
- `1`: One or more tests failed
- `2`: Error during test discovery or execution

This makes it suitable for use in CI/CD pipelines:

```yaml
# GitHub Actions example
- name: Run Griffin tests
  run: griffin run-local
```

## Troubleshooting

### Tests Not Being Discovered

**Problem**: CLI doesn't find your test files

**Solutions**:
- Ensure test files are in `__griffin__` subdirectories
- Check that files have `.ts` extension
- Verify test files properly export test plans
- Use `--verbose` flag to see discovery process

### Import Errors

**Problem**: `Cannot find module 'griffin-ts'`

**Solutions**:
- Install `griffin-ts`: `npm install griffin-ts`
- For local development in monorepo, use workspace linking
- Ensure TypeScript can resolve the module
- Check that the package is listed in `package.json`

### Connection Errors

**Problem**: Cannot connect to endpoint host

**Solutions**:
- Verify the API server is running
- Check the `endpoint_host` in your test configuration
- Ensure the host includes the protocol (`http://` or `https://`)
- Check network connectivity and firewall settings

### Timeout Errors

**Problem**: Tests timeout before completing

**Solutions**:
- Increase timeout in test configuration
- Check if API server is responding slowly
- Verify network connectivity
- Use `--verbose` to see where timeout occurs

## Best Practices

### Organizing Tests

- Group related tests in the same `__griffin__` directory
- Use descriptive file names: `user-api-tests.ts`, `auth-flow.ts`
- Keep tests focused on specific API areas

### Running in CI/CD

```yaml
# Example GitHub Actions workflow
name: API Tests
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: actions/setup-node@v3
      - run: npm install
      - run: npm install -g griffin-cli
      - run: griffin run-local
```

### Local Development

- Run `griffin run-local` frequently during development
- Use `--verbose` to debug test issues
- Keep your API server running on the configured port

## Next Steps

<CardGroup cols={2}>
  <Card title="Test System Guide" icon="code" href="/guides/test-system">
    Learn how to write tests.
  </Card>
  <Card title="Quickstart" icon="rocket" href="/quickstart">
    Get started with your first test.
  </Card>
</CardGroup>
